/**
 * The character used to mark the start and end of a placeholder name.
 */
var PLACEHOLDER_NAME_MARKER = ':';
/**
 * Load translations for `$localize`.
 *
 * The given `translations` are processed and added to a lookup based on their translation key.
 * A new translation will overwrite a previous translation if it has the same key.
 */
export function loadTranslations(translations) {
    // Ensure the translate function exists
    if (!$localize.translate) {
        $localize.translate = translate;
    }
    if (!$localize.TRANSLATIONS) {
        $localize.TRANSLATIONS = {};
    }
    Object.keys(translations).forEach(function (key) {
        $localize.TRANSLATIONS[key] = parseTranslation(translations[key]);
    });
}
/**
 * Remove all translations for `$localize`.
 */
export function clearTranslations() {
    $localize.TRANSLATIONS = {};
}
/**
 * Translate the text of the given message, using the loaded translations.
 *
 * This function may reorder (or remove) substitutions as indicated in the matching translation.
 */
export function translate(messageParts, substitutions) {
    var message = parseMessage(messageParts, substitutions);
    var translation = $localize.TRANSLATIONS[message.translationKey];
    var result = (translation === undefined ? [messageParts, substitutions] : [
        translation.messageParts,
        translation.placeholderNames.map(function (placeholder) { return message.substitutions[placeholder]; })
    ]);
    return result;
}
/////////////
// Helpers
/**
 * Parse the `messageParts` and `placeholderNames` out of a translation key.
 *
 * @param translationKey the message to be parsed.
 */
export function parseTranslation(translationKey) {
    var parts = translationKey.split(/{\$([^}]*)}/);
    var messageParts = [parts[0]];
    var placeholderNames = [];
    for (var i = 1; i < parts.length - 1; i += 2) {
        placeholderNames.push(parts[i]);
        messageParts.push("" + parts[i + 1]);
    }
    var rawMessageParts = messageParts.map(function (part) { return part.charAt(0) === PLACEHOLDER_NAME_MARKER ? '\\' + part : part; });
    return { messageParts: makeTemplateObject(messageParts, rawMessageParts), placeholderNames: placeholderNames };
}
/**
 * Process the `messageParts` and `substitutions` that were passed to the `$localize` tag in order
 * to match it to a translation.
 *
 * Specifically this function computes:
 * * the `translationKey` for looking up an appropriate translation for this message.
 * * a map of placeholder names to substitutions values.
 */
export function parseMessage(messageParts, expressions) {
    var replacements = {};
    var translationKey = messageParts[0];
    for (var i = 1; i < messageParts.length; i++) {
        var messagePart = messageParts[i];
        var expression = expressions[i - 1];
        // There is a problem with synthesizing template literals in TS.
        // It is not possible to provide raw values for the `messageParts` and TS is not able to compute
        // them since this requires access to the string in its original (non-existent) source code.
        // Therefore we fall back on the non-raw version if the raw string is empty.
        // This should be OK because synthesized nodes only come from the template compiler and they
        // will always contain placeholder name information.
        // So there will be no escaped placeholder marker character (`:`) directly after a substitution.
        if ((messageParts.raw[i] || messagePart).charAt(0) === PLACEHOLDER_NAME_MARKER) {
            var endOfPlaceholderName = messagePart.indexOf(PLACEHOLDER_NAME_MARKER, 1);
            var placeholderName = messagePart.substring(1, endOfPlaceholderName);
            translationKey += "{$" + placeholderName + "}" + messagePart.substring(endOfPlaceholderName + 1);
            replacements[placeholderName] = expression;
        }
        else {
            var placeholderName = "ph_" + i;
            translationKey += "{$" + placeholderName + "}" + messagePart;
            replacements[placeholderName] = expression;
        }
    }
    return { translationKey: translationKey, substitutions: replacements };
}
/**
 * Make an array of `cooked` strings that also holds the `raw` strings in an additional property.
 *
 * @param cooked The actual values of the `messagePart` strings.
 * @param raw The original raw values of the `messagePart` strings, before escape characters are
 * processed.
 */
function makeTemplateObject(cooked, raw) {
    Object.defineProperty(cooked, 'raw', { value: raw });
    return cooked;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvbG9jYWxpemUvcnVuX3RpbWUvc3JjL3RyYW5zbGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE2Q0E7O0dBRUc7QUFDSCxJQUFNLHVCQUF1QixHQUFHLEdBQUcsQ0FBQztBQUVwQzs7Ozs7R0FLRztBQUNILE1BQU0sVUFBVSxnQkFBZ0IsQ0FBQyxZQUEwQjtJQUN6RCx1Q0FBdUM7SUFDdkMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUU7UUFDeEIsU0FBUyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7S0FDakM7SUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRTtRQUMzQixTQUFTLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztLQUM3QjtJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsR0FBRztRQUNuQyxTQUFTLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxHQUFHLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLGlCQUFpQjtJQUMvQixTQUFTLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztBQUM5QixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxTQUFTLENBQUMsWUFBa0MsRUFBRSxhQUE2QjtJQUV6RixJQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQzFELElBQU0sV0FBVyxHQUFHLFNBQVMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ25FLElBQU0sTUFBTSxHQUNSLENBQUMsV0FBVyxLQUFLLFNBQVMsQ0FB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eEQsWUFBWSxDQUFDLGVBQWUsQ0FBQyxHQUFHLFVBQVUsQ0FBQztTQUM1QztLQUNGO0lBQ0QsT0FBTyxFQUFDLGNBQWMsZ0JBQUEsRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFDLENBQUM7QUFDdkQsQ0FBQztBQUVEOzs7Ozs7R0FNRztBQUNILFNBQVMsa0JBQWtCLENBQUMsTUFBZ0IsRUFBRSxHQUFhO0lBQ3pELE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUMsQ0FBQyxDQUFDO0lBQ25ELE9BQU8sTUFBYSxDQUFDO0FBQ3ZCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5pbXBvcnQge0xvY2FsaXplRm59IGZyb20gJ0Bhbmd1bGFyL2xvY2FsaXplJztcblxuLyoqXG4gKiBXZSBhdWdtZW50IHRoZSBgJGxvY2FsaXplYCBvYmplY3QgdG8gYWxzbyBzdG9yZSB0aGUgdHJhbnNsYXRpb25zLlxuICpcbiAqIE5vdGUgdGhhdCBiZWNhdXNlIHRoZSBUUkFOU0xBVElPTlMgYXJlIGF0dGFjaGVkIHRvIGEgZ2xvYmFsIG9iamVjdCwgdGhleSB3aWxsIGJlIHNoYXJlZCBiZXR3ZWVuXG4gKiBhbGwgYXBwbGljYXRpb25zIHRoYXQgYXJlIHJ1bm5pbmcgaW4gYSBzaW5nbGUgcGFnZSBvZiB0aGUgYnJvd3Nlci5cbiAqL1xuZGVjbGFyZSBjb25zdCAkbG9jYWxpemU6IExvY2FsaXplRm4me1RSQU5TTEFUSU9OUzoge1trZXk6IHN0cmluZ106IFBhcnNlZFRyYW5zbGF0aW9ufX07XG5cbi8qKlxuICogQSBtYXAgb2YgdHJhbnNsYXRpb25zLlxuICpcbiAqIFRoZSBrZXkgaXMgdGhlIG9yaWdpbmFsIHRyYW5zbGF0aW9uIG1lc3NhZ2UsIHRoZSB2YWx1ZSBpcyB0aGUgdHJhbnNsYXRlZCBtZXNzYWdlLlxuICpcbiAqIFRoZSBmb3JtYXQgb2YgdGhlc2UgdHJhbnNsYXRpb24gbWVzc2FnZSBzdHJpbmdzIHVzZXMgYHskbWFya2VyfWAgdG8gaW5kaWNhdGUgYSBwbGFjZWhvbGRlci5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUcmFuc2xhdGlvbnMgeyBbdHJhbnNsYXRpb25LZXk6IHN0cmluZ106IHN0cmluZzsgfVxuXG4vKipcbiAqIEEgdHJhbnNsYXRpb24gbWVzc2FnZSB0aGF0IGhhcyBiZWVuIHByb2Nlc3NlZCB0byBleHRyYWN0IHRoZSBtZXNzYWdlIHBhcnRzIGFuZCBwbGFjZWhvbGRlcnMuXG4gKlxuICogVGhpcyBpcyB0aGUgZm9ybWF0IHVzZWQgYnkgdGhlIHJ1bnRpbWUgaW5saW5pbmcgdG8gdHJhbnNsYXRlIG1lc3NhZ2VzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhcnNlZFRyYW5zbGF0aW9uIHtcbiAgbWVzc2FnZVBhcnRzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheTtcbiAgcGxhY2Vob2xkZXJOYW1lczogc3RyaW5nW107XG59XG5cbi8qKlxuICogQSBsb2NhbGl6ZWQgbWVzc2FnZSB0aGF0IGhhcyBiZWVuIHByb2Nlc3NlZCB0byBjb21wdXRlIHRoZSB0cmFuc2xhdGlvbiBrZXkgZm9yIGxvb2tpbmcgdXAgdGhlXG4gKiBhcHByb3ByaWF0ZSB0cmFuc2xhdGlvbi5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQYXJzZWRNZXNzYWdlIHtcbiAgdHJhbnNsYXRpb25LZXk6IHN0cmluZztcbiAgc3Vic3RpdHV0aW9uczoge1twbGFjZWhvbGRlck5hbWU6IHN0cmluZ106IGFueX07XG59XG5cbi8qKlxuICogVGhlIGNoYXJhY3RlciB1c2VkIHRvIG1hcmsgdGhlIHN0YXJ0IGFuZCBlbmQgb2YgYSBwbGFjZWhvbGRlciBuYW1lLlxuICovXG5jb25zdCBQTEFDRUhPTERFUl9OQU1FX01BUktFUiA9ICc6JztcblxuLyoqXG4gKiBMb2FkIHRyYW5zbGF0aW9ucyBmb3IgYCRsb2NhbGl6ZWAuXG4gKlxuICogVGhlIGdpdmVuIGB0cmFuc2xhdGlvbnNgIGFyZSBwcm9jZXNzZWQgYW5kIGFkZGVkIHRvIGEgbG9va3VwIGJhc2VkIG9uIHRoZWlyIHRyYW5zbGF0aW9uIGtleS5cbiAqIEEgbmV3IHRyYW5zbGF0aW9uIHdpbGwgb3ZlcndyaXRlIGEgcHJldmlvdXMgdHJhbnNsYXRpb24gaWYgaXQgaGFzIHRoZSBzYW1lIGtleS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWRUcmFuc2xhdGlvbnModHJhbnNsYXRpb25zOiBUcmFuc2xhdGlvbnMpIHtcbiAgLy8gRW5zdXJlIHRoZSB0cmFuc2xhdGUgZnVuY3Rpb24gZXhpc3RzXG4gIGlmICghJGxvY2FsaXplLnRyYW5zbGF0ZSkge1xuICAgICRsb2NhbGl6ZS50cmFuc2xhdGUgPSB0cmFuc2xhdGU7XG4gIH1cbiAgaWYgKCEkbG9jYWxpemUuVFJBTlNMQVRJT05TKSB7XG4gICAgJGxvY2FsaXplLlRSQU5TTEFUSU9OUyA9IHt9O1xuICB9XG4gIE9iamVjdC5rZXlzKHRyYW5zbGF0aW9ucykuZm9yRWFjaChrZXkgPT4ge1xuICAgICRsb2NhbGl6ZS5UUkFOU0xBVElPTlNba2V5XSA9IHBhcnNlVHJhbnNsYXRpb24odHJhbnNsYXRpb25zW2tleV0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBSZW1vdmUgYWxsIHRyYW5zbGF0aW9ucyBmb3IgYCRsb2NhbGl6ZWAuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGVhclRyYW5zbGF0aW9ucygpIHtcbiAgJGxvY2FsaXplLlRSQU5TTEFUSU9OUyA9IHt9O1xufVxuXG4vKipcbiAqIFRyYW5zbGF0ZSB0aGUgdGV4dCBvZiB0aGUgZ2l2ZW4gbWVzc2FnZSwgdXNpbmcgdGhlIGxvYWRlZCB0cmFuc2xhdGlvbnMuXG4gKlxuICogVGhpcyBmdW5jdGlvbiBtYXkgcmVvcmRlciAob3IgcmVtb3ZlKSBzdWJzdGl0dXRpb25zIGFzIGluZGljYXRlZCBpbiB0aGUgbWF0Y2hpbmcgdHJhbnNsYXRpb24uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2xhdGUobWVzc2FnZVBhcnRzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSwgc3Vic3RpdHV0aW9uczogcmVhZG9ubHkgYW55W10pOlxuICAgIFtUZW1wbGF0ZVN0cmluZ3NBcnJheSwgcmVhZG9ubHkgYW55W11dIHtcbiAgY29uc3QgbWVzc2FnZSA9IHBhcnNlTWVzc2FnZShtZXNzYWdlUGFydHMsIHN1YnN0aXR1dGlvbnMpO1xuICBjb25zdCB0cmFuc2xhdGlvbiA9ICRsb2NhbGl6ZS5UUkFOU0xBVElPTlNbbWVzc2FnZS50cmFuc2xhdGlvbktleV07XG4gIGNvbnN0IHJlc3VsdDogW1RlbXBsYXRlU3RyaW5nc0FycmF5LCByZWFkb25seSBhbnlbXV0gPVxuICAgICAgKHRyYW5zbGF0aW9uID09PSB1bmRlZmluZWQgPyBbbWVzc2FnZVBhcnRzLCBzdWJzdGl0dXRpb25zXSA6IFtcbiAgICAgICAgdHJhbnNsYXRpb24ubWVzc2FnZVBhcnRzLFxuICAgICAgICB0cmFuc2xhdGlvbi5wbGFjZWhvbGRlck5hbWVzLm1hcChwbGFjZWhvbGRlciA9PiBtZXNzYWdlLnN1YnN0aXR1dGlvbnNbcGxhY2Vob2xkZXJdKVxuICAgICAgXSk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8vLy8vLy8vLy8vLy9cbi8vIEhlbHBlcnNcblxuLyoqXG4gKiBQYXJzZSB0aGUgYG1lc3NhZ2VQYXJ0c2AgYW5kIGBwbGFjZWhvbGRlck5hbWVzYCBvdXQgb2YgYSB0cmFuc2xhdGlvbiBrZXkuXG4gKlxuICogQHBhcmFtIHRyYW5zbGF0aW9uS2V5IHRoZSBtZXNzYWdlIHRvIGJlIHBhcnNlZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVHJhbnNsYXRpb24odHJhbnNsYXRpb25LZXk6IHN0cmluZyk6IFBhcnNlZFRyYW5zbGF0aW9uIHtcbiAgY29uc3QgcGFydHMgPSB0cmFuc2xhdGlvbktleS5zcGxpdCgve1xcJChbXn1dKil9Lyk7XG4gIGNvbnN0IG1lc3NhZ2VQYXJ0cyA9IFtwYXJ0c1swXV07XG4gIGNvbnN0IHBsYWNlaG9sZGVyTmFtZXM6IHN0cmluZ1tdID0gW107XG4gIGZvciAobGV0IGkgPSAxOyBpIDwgcGFydHMubGVuZ3RoIC0gMTsgaSArPSAyKSB7XG4gICAgcGxhY2Vob2xkZXJOYW1lcy5wdXNoKHBhcnRzW2ldKTtcbiAgICBtZXNzYWdlUGFydHMucHVzaChgJHtwYXJ0c1tpICsgMV19YCk7XG4gIH1cbiAgY29uc3QgcmF3TWVzc2FnZVBhcnRzID1cbiAgICAgIG1lc3NhZ2VQYXJ0cy5tYXAocGFydCA9PiBwYXJ0LmNoYXJBdCgwKSA9PT0gUExBQ0VIT0xERVJfTkFNRV9NQVJLRVIgPyAnXFxcXCcgKyBwYXJ0IDogcGFydCk7XG4gIHJldHVybiB7bWVzc2FnZVBhcnRzOiBtYWtlVGVtcGxhdGVPYmplY3QobWVzc2FnZVBhcnRzLCByYXdNZXNzYWdlUGFydHMpLCBwbGFjZWhvbGRlck5hbWVzfTtcbn1cblxuLyoqXG4gKiBQcm9jZXNzIHRoZSBgbWVzc2FnZVBhcnRzYCBhbmQgYHN1YnN0aXR1dGlvbnNgIHRoYXQgd2VyZSBwYXNzZWQgdG8gdGhlIGAkbG9jYWxpemVgIHRhZyBpbiBvcmRlclxuICogdG8gbWF0Y2ggaXQgdG8gYSB0cmFuc2xhdGlvbi5cbiAqXG4gKiBTcGVjaWZpY2FsbHkgdGhpcyBmdW5jdGlvbiBjb21wdXRlczpcbiAqICogdGhlIGB0cmFuc2xhdGlvbktleWAgZm9yIGxvb2tpbmcgdXAgYW4gYXBwcm9wcmlhdGUgdHJhbnNsYXRpb24gZm9yIHRoaXMgbWVzc2FnZS5cbiAqICogYSBtYXAgb2YgcGxhY2Vob2xkZXIgbmFtZXMgdG8gc3Vic3RpdHV0aW9ucyB2YWx1ZXMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZU1lc3NhZ2UoXG4gICAgbWVzc2FnZVBhcnRzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSwgZXhwcmVzc2lvbnM6IHJlYWRvbmx5IGFueVtdKTogUGFyc2VkTWVzc2FnZSB7XG4gIGNvbnN0IHJlcGxhY2VtZW50czoge1twbGFjZWhvbGRlck5hbWU6IHN0cmluZ106IGFueX0gPSB7fTtcbiAgbGV0IHRyYW5zbGF0aW9uS2V5ID0gbWVzc2FnZVBhcnRzWzBdO1xuICBmb3IgKGxldCBpID0gMTsgaSA8IG1lc3NhZ2VQYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IG1lc3NhZ2VQYXJ0ID0gbWVzc2FnZVBhcnRzW2ldO1xuICAgIGNvbnN0IGV4cHJlc3Npb24gPSBleHByZXNzaW9uc1tpIC0gMV07XG4gICAgLy8gVGhlcmUgaXMgYSBwcm9ibGVtIHdpdGggc3ludGhlc2l6aW5nIHRlbXBsYXRlIGxpdGVyYWxzIGluIFRTLlxuICAgIC8vIEl0IGlzIG5vdCBwb3NzaWJsZSB0byBwcm92aWRlIHJhdyB2YWx1ZXMgZm9yIHRoZSBgbWVzc2FnZVBhcnRzYCBhbmQgVFMgaXMgbm90IGFibGUgdG8gY29tcHV0ZVxuICAgIC8vIHRoZW0gc2luY2UgdGhpcyByZXF1aXJlcyBhY2Nlc3MgdG8gdGhlIHN0cmluZyBpbiBpdHMgb3JpZ2luYWwgKG5vbi1leGlzdGVudCkgc291cmNlIGNvZGUuXG4gICAgLy8gVGhlcmVmb3JlIHdlIGZhbGwgYmFjayBvbiB0aGUgbm9uLXJhdyB2ZXJzaW9uIGlmIHRoZSByYXcgc3RyaW5nIGlzIGVtcHR5LlxuICAgIC8vIFRoaXMgc2hvdWxkIGJlIE9LIGJlY2F1c2Ugc3ludGhlc2l6ZWQgbm9kZXMgb25seSBjb21lIGZyb20gdGhlIHRlbXBsYXRlIGNvbXBpbGVyIGFuZCB0aGV5XG4gICAgLy8gd2lsbCBhbHdheXMgY29udGFpbiBwbGFjZWhvbGRlciBuYW1lIGluZm9ybWF0aW9uLlxuICAgIC8vIFNvIHRoZXJlIHdpbGwgYmUgbm8gZXNjYXBlZCBwbGFjZWhvbGRlciBtYXJrZXIgY2hhcmFjdGVyIChgOmApIGRpcmVjdGx5IGFmdGVyIGEgc3Vic3RpdHV0aW9uLlxuICAgIGlmICgobWVzc2FnZVBhcnRzLnJhd1tpXSB8fCBtZXNzYWdlUGFydCkuY2hhckF0KDApID09PSBQTEFDRUhPTERFUl9OQU1FX01BUktFUikge1xuICAgICAgY29uc3QgZW5kT2ZQbGFjZWhvbGRlck5hbWUgPSBtZXNzYWdlUGFydC5pbmRleE9mKFBMQUNFSE9MREVSX05BTUVfTUFSS0VSLCAxKTtcbiAgICAgIGNvbnN0IHBsYWNlaG9sZGVyTmFtZSA9IG1lc3NhZ2VQYXJ0LnN1YnN0cmluZygxLCBlbmRPZlBsYWNlaG9sZGVyTmFtZSk7XG4gICAgICB0cmFuc2xhdGlvbktleSArPSBgeyQke3BsYWNlaG9sZGVyTmFtZX19JHttZXNzYWdlUGFydC5zdWJzdHJpbmcoZW5kT2ZQbGFjZWhvbGRlck5hbWUgKyAxKX1gO1xuICAgICAgcmVwbGFjZW1lbnRzW3BsYWNlaG9sZGVyTmFtZV0gPSBleHByZXNzaW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBwbGFjZWhvbGRlck5hbWUgPSBgcGhfJHtpfWA7XG4gICAgICB0cmFuc2xhdGlvbktleSArPSBgeyQke3BsYWNlaG9sZGVyTmFtZX19JHttZXNzYWdlUGFydH1gO1xuICAgICAgcmVwbGFjZW1lbnRzW3BsYWNlaG9sZGVyTmFtZV0gPSBleHByZXNzaW9uO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge3RyYW5zbGF0aW9uS2V5LCBzdWJzdGl0dXRpb25zOiByZXBsYWNlbWVudHN9O1xufVxuXG4vKipcbiAqIE1ha2UgYW4gYXJyYXkgb2YgYGNvb2tlZGAgc3RyaW5ncyB0aGF0IGFsc28gaG9sZHMgdGhlIGByYXdgIHN0cmluZ3MgaW4gYW4gYWRkaXRpb25hbCBwcm9wZXJ0eS5cbiAqXG4gKiBAcGFyYW0gY29va2VkIFRoZSBhY3R1YWwgdmFsdWVzIG9mIHRoZSBgbWVzc2FnZVBhcnRgIHN0cmluZ3MuXG4gKiBAcGFyYW0gcmF3IFRoZSBvcmlnaW5hbCByYXcgdmFsdWVzIG9mIHRoZSBgbWVzc2FnZVBhcnRgIHN0cmluZ3MsIGJlZm9yZSBlc2NhcGUgY2hhcmFjdGVycyBhcmVcbiAqIHByb2Nlc3NlZC5cbiAqL1xuZnVuY3Rpb24gbWFrZVRlbXBsYXRlT2JqZWN0KGNvb2tlZDogc3RyaW5nW10sIHJhdzogc3RyaW5nW10pOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSB7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsICdyYXcnLCB7dmFsdWU6IHJhd30pO1xuICByZXR1cm4gY29va2VkIGFzIGFueTtcbn1cbiJdfQ==